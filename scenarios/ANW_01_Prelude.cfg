#textdomain wesnoth-A_New_World
[scenario]
    id=ANW_01_Prelude
    name= _ "Prelude"
    next_scenario=null
    map_file="NewWorld.map"
    victory_when_enemies_defeated=no

    {DEFAULT_SCHEDULE}

    #Initialize sides
    [event]
        name=prestart
        [lua]
            code=<<
                -- version-safe side accessor
                local function side(i)
                    if wesnoth.sides and wesnoth.sides.get then return wesnoth.sides.get(i) end
                    if wesnoth.sides then return wesnoth.sides[i] end
                    if wesnoth.get_side then return wesnoth.get_side(i) end
                end

                -- collect side ids
                local ids, i = {}, 1
                while true do
                    local s = side(i)
                    if not s then break end
                    ids[#ids+1] = i
                    i = i + 1
                end

                local function tok(a,b)
                    if a>b then a,b=b,a end
                    return ("p%02d_%02d"):format(a,b)
                end

                -- baseline: everyone allies with everyone via pair tokens
                for _, a in ipairs(ids) do
                    local list = {}
                    for _, b in ipairs(ids) do
                        if b ~= a then list[#list+1] = tok(a,b) end
                    end
                    side(a).team_name = table.concat(list, ",")
                end

                -- helper to declare a war = remove exactly that pair token
                local function declare_war(a,b)
                    if a>b then a,b=b,a end
                    local T = tok(a,b)
                    for _, sId in ipairs{a,b} do
                        local s = side(sId)
                        local kept = {}
                        for t in string.gmatch(s.team_name or "", "[^,]+") do
                            if t ~= "" and t ~= T then kept[#kept+1] = t end
                        end
                        s.team_name = table.concat(kept, ",")
                    end
                end

                -- Initializes which sides are at war (7) hates everyone:
                declare_war(1,2)
                declare_war(1,3)
                declare_war(3,4)
                declare_war(7,1)
                declare_war(7,2)
                declare_war(7,3)
                declare_war(7,4)
                declare_war(7,5)
                declare_war(7,6)
            >>
        [/lua]

    [/event]

    [side]
        side=1
        controller=human
        team_name=humans
        user_team_name= _ "Player"
        type=Peasant
        recruit=Peasant
        gold=100
        fog=no
        shroud=no
    [/side]

    [side]
        side=2
        controller=ai
        team_name=dwarves
        user_team_name= _ "Dwarves"
        type=Dwarvish Lord
        recruit=Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Ulfserker,Dwarvish Guardsman
        gold=10
    [/side]

    [side]
        side=3
        controller=ai
        team_name=undead
        user_team_name= _ "Undead"
        type=Ancient Lich
        recruit=Skeleton,Skeleton Archer,Dark Adept,Ghoul,Ghost
        gold=10
    [/side]

    [side]
        side=4
        controller=ai
        team_name=goblins
        user_team_name= _ "Goblins"
        type=Goblin Rouser
        recruit=Goblin Spearman,Wolf Rider
        gold=40
    [/side]

    [side]
        side=5
        controller=ai
        team_name=merfolk
        user_team_name= _ "Merfolk"
        type=Merman Warrior
        recruit=Merman Fighter,Mermaid Initiate,Merman Hunter
        gold=10
    [/side]

    [side]
        side=6
        controller=ai
        team_name=dunefolk
        user_team_name= _ "Dunefolk"
        type=Dune Paragon
        recruit=Dune Burner, Dune Skirmisher
        gold=10
    [/side]

    [side]
        side=7
        controller=ai
        team_name=wildlife
        user_team_name= _ "Wildlife"
        type=Giant Ant Queen
        recruit=Giant Ant, Dragonfly, Fire Ant, Fire Ant Egg
        gold=10
    [/side]

    [objectives]
        side=1
        [objective]
            description= _ "Defeat all enemy leaders"
            condition=win
        [/objective]
        [objective]
            description= _ "Death of your leader"
            condition=lose
        [/objective]
        note= _ "Enemies will get progressively stonger"
    [/objectives]

    # [event]
    #     name=start
    #     {DECLARE_WAR 1 4}
    # [/event]

    # {ANW_ENEMY_BUFFS 2,3,4,5,6 100 0}
    # {ANW_ENEMY_BUFFS 7 100 0} #ants get stronger
    # {ANW_LEADER_DAMAGE_UP 2,3,4,5,6,7 100}
    # {ANW_LEADER_REGEN_PERCENT 2,3,4,5,6,7 10}

    # # Makes the ant queen summon ants every turn
    # {ANW_GIVE_SUMMON_LEADER 7 ANW_SUMMON_SOLDIER_ANT "Soldier Ant" 2}

    # {DIPLOMACY_ENABLE}
[/scenario]
